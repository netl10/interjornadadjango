{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block object-tools-items %}
    {{ block.super }}
    <li>
        {% if show_completed %}
            <a href="?show_completed=false" class="addlink">
                ðŸ“‹ Ocultar SessÃµes ConcluÃ­das
            </a>
        {% else %}
            <a href="?show_completed=true" class="addlink">
                ðŸ“‹ Mostrar SessÃµes ConcluÃ­das
            </a>
        {% endif %}
    </li>
{% endblock %}

{% block content %}
    <div class="module filtered" id="changelist">
        <div class="results">
            <div class="xfull">
                <div style="display: flex; gap: 20px; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; border: 1px solid #dee2e6;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px;">ATIVOS</span>
                        <span id="active-count" style="font-weight: bold; color: #28a745;">-</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px;">BLOQUEADOS</span>
                        <span id="blocked-count" style="font-weight: bold; color: #dc3545;">-</span>
                    </div>
                </div>
            </div>
        </div>
        {{ block.super }}
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // FunÃ§Ã£o para atualizar contadores
            function updateCounters() {
                fetch('/api/v1/employee_sessions/api/session-counts/')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById('active-count').textContent = data.active_count;
                            document.getElementById('blocked-count').textContent = data.blocked_count;
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao buscar contadores:', error);
                    });
            }
            
            // Atualizar contadores na carga da pÃ¡gina
            updateCounters();
            
            // Atualizar contadores a cada 30 segundos
            setInterval(updateCounters, 30000);
        });
    </script>
{% endblock %}
